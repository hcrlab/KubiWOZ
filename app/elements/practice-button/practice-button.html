<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">

<polymer-element name="practice-button" attributes="prompt1 prompt2 prompt3 textEN textFR lan image">
  <template>
    <link rel="stylesheet" href="../fb-button.css">

    <app-globals id="globals"></app-globals>

    <paper-button raised class="colored" on-click="{{practice}}"><content id="content"></content></paper-button>
  </template>
  <script>
    (function () {
      var fb = null;

      Polymer({

        prompt1: " in French is ",
        prompt2: " please repeat after me ",
        prompt3: " one more time ",
        textEN: null,
        textFR: null,
        lan: 'EN',
        image: null,

        ready: function() {
          var that = this;
          this.$.globals.setCurrentListener('practice', function(){
            fb = new Firebase('https://hcrkubi.firebaseio.com/' + that.$.globals.data.current + '/practice');
          });
        },

        practice: function() {
          console.log('Practice');

          if(!this.textEN) {
            this.textEN = this.$.content.getDistributedNodes()[0].data;
          }

          this.textEN += this.prompt1;

          fb.push().set({
            tasks: [{
              speech: {
                text: this.textEN,
                language: this.lan
              },
              image: this.image
            },
            {
              speech: {
                text: this.textFR,
                language: 'FR'
              },
              image: this.image
            },
            {
              speech: {
                text: this.prompt2,
                language: this.lan
              },
              image: this.image
            },
            {
              speech: {
                text: this.textFR,
                language: 'FR'
              },
              image: this.image
            },
            {
              speech: {
                text: this.prompt3,
                language: this.lan
              },
              image: this.image
            },
            {
              speech: {
                text: this.textFR,
                language: 'FR'
              },
              image: this.image
            }],
            handled: false
          });
        }
      });
    })();
  </script>
</polymer-element>
